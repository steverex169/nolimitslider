{% extends 'agent/template.html' %}

{% block content %}
<div class="main px-4 py-3">

    <!-- Greeting with circular badge -->
    <div class="d-flex align-items-center mb-4">
        <!-- Circular badge -->
        <div class="circle-badge me-2">
            {{ request.user.username|slice:":1" }}{{ request.user.username|slice:"1:2"|upper }}
        </div>

        <!-- Greeting text -->
        <h4 class="mb-0" style="font-weight: bold; color: black;">{{ greeting }}, {{ request.user.username }}!</h4>
    </div>


    <!-- Real-time Overview -->
     <p style="font-weight: bold; color: black;">Real Time Overview</p>
    <div class="row g-3 mb-4">
        <div class="col-md-4">
            <div class="card text-center shadow-sm">
                <div class="card-body">
                    <h6 class="text-muted">Customers online</h6>
                    <h2>{{ customers_online }}</h2>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-center shadow-sm">
                <div class="card-body">
                    <h6 class="text-muted">Ongoing chats</h6>
                    <h2>{{ active_chats|length }}</h2>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-center shadow-sm">
                <div class="card-body">
                    <h6 class="text-muted">Logged in agents</h6>
                    <h2 class="mb-0">
                        {{ logged_agents }}
                        <small class="text-muted" style="font-size: 0.5em;">of {{ total_agents }}</small>
                    </h2>
                </div>
            </div>
        </div>
    </div>

    <!-- Chat Statistics Chart (your original code kept here) -->
    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <h5 class="card-title">ðŸ“Š Chat Statistics</h5>
            <canvas id="chatChart" height="120"></canvas>
        </div>
    </div>

</div>
<style>
    .main {
        margin-left: 32px;
    }
    .circle-badge {
    width: 40px;
    height: 40px;
    background-color: #4a90e2;
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 16px;
}
@media (max-width: 576px) {
    .circle-badge {
        width: 40px;
        height: 40px;
        font-size: 14px;
    }
    .main h4 {
        font-size: 1.1rem;
    }
}

</style>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const ctx = document.getElementById('chatChart').getContext('2d');
const chatChart = new Chart(ctx, {
    type: 'bar',
    data: {
        labels: {{ last_7_days_labels|safe }},
        datasets: [{
            label: "Chats",
            data: {{ chat_counts|safe }},
            backgroundColor: "rgba(54, 162, 235, 0.6)",
            borderColor: "rgba(54, 162, 235, 1)",
            borderWidth: 1,
            borderRadius: 5
        }]
    },
    options: {
        responsive: true,
        scales: { y: { beginAtZero: true } }
    }
});
</script>
{% endblock %}
