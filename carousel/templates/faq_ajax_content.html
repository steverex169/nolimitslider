<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>FAQ Manager</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: #f8f9fa;
        }

        .card {
            border-radius: 12px;
            overflow: hidden;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
        }

        table tbody tr:hover {
            background-color: #f1f1f1;
            transition: background 0.2s ease;
        }

        .btn {
            border-radius: 6px;
        }
    </style>
</head>

<body>
    <div class="container py-5">

        <h2 class="mb-4 fw-bold text-center">FAQ Manager</h2>

        <div id="alerts-container" class="mb-3">
            <div id="success-alert" class="alert alert-success d-none">‚úÖ FAQ added successfully!</div>
            <div id="error-alert" class="alert alert-danger d-none"></div>
        </div>


        <div class="card mb-4 shadow-sm">
            <div class="card-header bg-primary text-white fw-semibold">‚ûï Add New FAQ</div>
            <div class="card-body">
                <form id="add-faq-form" method="post" action="{% url 'add_faq' %}">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label class="form-label fw-semibold">Question</label>
                        <input type="text" name="question" class="form-control" placeholder="Enter your question"
                            required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-semibold">Answer</label>
                        <textarea name="answer" class="form-control" rows="3" placeholder="Enter the answer"
                            required></textarea>
                    </div>
                    <button type="submit" class="btn btn-success px-4">Save FAQ</button>
                </form>
            </div>
        </div>

        <div class="card shadow-sm">
            <div class="card-header bg-dark text-white fw-semibold">üìã All FAQs</div>
            <div class="card-body">
                {% if faqs %}
                <table class="table table-bordered table-hover align-middle">
                    <thead class="table-light">
                        <tr>
                            <th style="width:30%;">Question</th>
                            <th style="width:50%;">Answer</th>
                            <th style="width:20%; text-align: center;">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="faq-list">
                        {% for faq in faqs %}
                        <tr>
                            <td class="fw-medium">{{ faq.question }}</td>
                            <td>{{ faq.answer|linebreaksbr }}</td>
                            <td style="text-align: center;">
                                <form method="post" action="{% url 'delete_faq' faq.id %}" style="display:inline;">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-danger btn-sm"
                                        onclick="return confirm('Are you sure you want to delete this FAQ?');">
                                        Delete
                                    </button>
                                </form>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <p class="text-muted fst-italic">No FAQs yet. Add your first one above.</p>
                {% endif %}
            </div>
        </div>


        <script>
            const form = document.getElementById('add-faq-form');
            const successAlert = document.getElementById('success-alert');
            const errorAlert = document.getElementById('error-alert');
            const faqList = document.getElementById('faq-list');

            form.addEventListener('submit', function (e) {
                e.preventDefault();
                const formData = new FormData(form);

                // Clear previous alerts
                successAlert.style.display = "none";
                errorAlert.style.display = "none";

                console.log("Submitting form...");

                fetch(form.action, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': formData.get('csrfmiddlewaretoken'),
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    body: formData
                })
                    .then(res => {
                        console.log("Received response from server...");
                        return res.json();
                    })
                    .then(data => {
                        console.log("Response JSON:", data);

                        if (data.success) {
                            console.log("‚úÖ FAQ added successfully!");

                            // Show success alert
                            successAlert.style.display = "block";
                            successAlert.innerText = "‚úÖ FAQ added successfully!";

                            // Hide the error alert if it was shown
                            errorAlert.style.display = "none";

                            setTimeout(() => successAlert.style.display = "none", 10000);

                            // Reset form and append new FAQ to the list
                            form.reset();

                            const newRow = document.createElement('tr');
                            newRow.innerHTML = `
                <td class="fw-medium">${data.faq.question}</td>
                <td>${data.faq.answer}</td>
                <td>
                    <form method="post" action="/faqs/delete/${data.faq.id}/" style="display:inline;">
                        <input type="hidden" name="csrfmiddlewaretoken" value="${formData.get('csrfmiddlewaretoken')}">
                        <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure?');">üóë Delete</button>
                    </form>
                </td>`;
                            faqList.appendChild(newRow);
                        } else {
                            console.warn("‚ùå Error adding FAQ:", data.error);

                            // Display error alert
                            errorAlert.style.display = "block";
                            errorAlert.innerText = data.error || 'Failed to add FAQ';

                            // Hide success alert if it was shown
                            successAlert.style.display = "none";
                        }
                    })
                    .catch(err => {
                        console.error("‚ùå Error occurred:", err);

                        // Display server error alert
                        errorAlert.style.display = "block";
                        errorAlert.innerText = 'Server error: could not save FAQ';

                        // Hide success alert if it was shown
                        successAlert.style.display = "none";
                    });
            });


        </script>
</body>

</html>