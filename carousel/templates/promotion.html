<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <title>Promotions</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: Arial, sans-serif;
      background-color: #0f1a1e;
      color: white;

    }

    .main-div {
      display: flex;
      justify-content: center;
      margin-bottom: 50px;
      padding: 70px;

    }

    .promotions-section {
      padding: 40px 0;
    }

    .section-title {
      font-size: 1.5rem;
      font-weight: bold;
      display: inline-block;
      /* important for gradient text clipping */
      background: linear-gradient(90deg, #00E6E6, #FF4D94);
      background-size: 100%;
      background-repeat: repeat;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      color: transparent;
    }

    .promotions-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 29px;
      justify-content: center;
      margin-top: 40px;
      width: 100%;
      max-width: 1600px;
      margin-left: auto;
      margin-right: auto;
    }


    /* --- Fix for .promo-card --- */
    .promo-card {
      width: 100%;
      max-width: 511px;
      height: auto;
      background-color: #2C2E35;
      border-radius: 18px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      margin: 0 auto;
      padding: 0 20px;
    }

    .dot-span {
      visibility: hidden;
    }

    .promo-card:hover {
      transform: translateY(-10px);
      /* slight lift on hover */
      box-shadow: 0 10px 30px rgba(0, 230, 230, 0.25);
      /* glow shadow */
    }


    /* --- Fix for .promo-image --- */
    .promo-image {
      width: 100%;
      max-width: 473px;
      height: auto;
      border-radius: 12px;
      object-fit: cover;
      margin-top: 16px;
      transition: transform 0.3s ease, filter 0.3s ease;
    }

    .promo-image:hover {
      transform: scale(1.03);
      filter: brightness(1.1);
    }

    .promo-content {
      padding: 20px 8px;
      display: flex;
      flex-direction: column;
      flex: 1;
      width: 100%;
      gap: 14px;
    }

    .promo-title {
      width: 357px;
      font-size: 25px;
      font-weight: 700;
      text-transform: uppercase;
      color: #ffffff;
      font-style: bold;
    }

    .promo-text {
      font-size: 20px;
      font-weight: 700PX;
      font-style: bold;
      line-height: 1.5;
      color: #e1e1e1;
      /* margin-top: 10px; */
    }

    .promo-text strong {
      color: #fff;
    }

    .bonus-code {
      font-size: 20px;
      font-style: bold;
      font-weight: 700;
      color: #ffffff;
      /* margin-top: 10px; */
    }

    .bonus-code span {
      margin-left: 10px;
      font-size: 20px;
      font-weight: 500px;
      color: #00E6E6;
      /* margin-top: 10px; */
    }

    .read-more {
      margin-top: auto;
      display: block;
      background-color: #FF4D95;
      color: white;
      font-size: 23px;
      font-weight: 700;
      text-align: center;
      padding: 16px 0;
      border-radius: 10px;
      text-decoration: none;
      transition: background-color 0.3s ease;
      width: 218px;
      height: 61px;
      transition: background-color 0.3s ease, transform 0.1s ease;
    }

    .read-more:hover {
      background: linear-gradient(90deg, #00e6e6, #ff4d94);
      color: #101820;
      box-shadow: 0 0 20px rgba(255, 77, 148, 0.7),
        0 0 30px rgba(0, 230, 230, 0.6);
    }

    .read-more:active {
      transform: scale(0.95);
      /* press-down effect */
    }

    .footer-section a {
      position: relative;
      z-index: 9999;
      pointer-events: auto;
    }

    @media (max-width: 992px) {
      .promotions-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 20px;
      }

      .promo-card {
        max-width: 100%;
      }
    }

    @media (max-width: 576px) {
      .promotions-grid {
        grid-template-columns: 1fr;
        gap: 16px;
        padding: 0 5px;
      }

      .promo-content {
        padding: 20px 24px;
        display: flex;
        flex-direction: column;
        flex: 1;
        width: 100%;
        gap: 8px;
        align-items: flex-start;
        /* left side pe content */
        text-align: left;
        /* text left align */
      }

      /* Agar headings aur paragraphs center ho rahe hain */
      .promo-content h4,
      .promo-content p,
      .promo-content h2,
      .promo-content ul,
      .promo-content li {
        text-align: left !important;
      }

      .bonus-code span {
        margin-left: 0px;
        font-size: 20px;
        font-weight: 500px;
        color: #00E6E6;
        /* margin-top: 10px; */
      }

      .promo-card {
        width: 100%;
        max-width: 100%;
      }

      .promo-image {
        width: 100%;
        height: auto;
        border-radius: 12px;
        object-fit: cover;
        margin-top: 16px;
        transition: transform 0.3s ease, filter 0.3s ease;
        max-width: 100%;
      }

      .promo-title {
        width: 209px;
      }

      .promo-title,
      .promo-text,
      .bonus-code {
        font-size: 14px;
      }

      .read-more {
        width: 100%;
        font-size: 18px;
        padding: 7px 0;
        height: 42px;
      }

    }

  /* Chat box */
  #chat-box {
    background: url('/media/promotion/Rectangle 15.png') no-repeat center center;
    background-size: cover;
    color: white;
    width: 360px;
    height: 480px;
    border-radius: 12px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  /* Header */
  .chat-header {
    background: rgba(0,0,0,0.6);
    color: white;
    padding: 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid #222;
  }

  .chat-header-left {
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .chat-menu {
    display: none;              /* IMPORTANT: default hidden */
    position: absolute;
    right: 0;
    top: 25px;
    background: #2c2c2c;
    padding: 6px 12px;
    border-radius: 40px;
    align-items: center;
    gap: 8px;
    min-width: 165px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.35);
  }

  /* when visible we will set display:flex from JS */
  .chat-menu.show {
    display: flex;
  }


  .agent-icon {
    width: 32px;
    height: 32px;
    background: #000;
    border: 2px solid #444;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
  }

  .agent-icon img {
    width: 28px;
    height: 28px;
    border-radius: 50%;
  }

  .agent-name {
    font-weight: bold;
    font-size: 14px;
  }

  .agent-status {
    font-size: 11px;
    color: #bbb;
  }

  .sound-circle {
    background: #fff;
    border-radius: 50%;
    width: 28px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
  }

  /* Messages area */
  #chat-messages {
    flex: 1;
    padding: 12px;
    overflow-y: auto;
    background: #000000aa; /* semi-transparent overlay */
  }

  /* Typing indicator */
  #typing-indicator {
    display: none;
    font-size: 12px;
    padding: 5px;
    color: gray;
  }

  /* Messages Common */
  #chat-messages .user-msg,
  #chat-messages .agent-msg,
  #chat-messages .bot-msg {
    display: flex;
    align-items: flex-start;
    margin: 8px 0;
    gap: 6px;
  }

  #chat-messages .bubble {
    padding: 10px 14px;
    border-radius: 14px;
    max-width: 70%;
    word-wrap: break-word;
    font-size: 14px;
    line-height: 1.4em;
  }

  /* User (Right Side) */
  .user-msg {
    justify-content: flex-end;
  }

  .user-msg .bubble {
    background: #00E6E6;
    color: #000;
    border-radius: 12px 12px 0 12px;
  }

  /* Agent (Pink) */
  .agent-msg .bubble {
    background: #FF4D94;
    color: white;
    border-radius: 12px 12px 12px 0;
  }

  .agent-msg .icon {
    width: 32px;
    height: 32px;
    background: #000;
    border: 2px solid #444;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    background-image: url('/media/promotion/chatbot 2.png');
    background-size: cover;
  }

  /* Bot (Gray) */
  .bot-msg .bubble {
    background: #383838;
    color: #fff;
    border-radius: 12px;
  }

  .bot-msg .icon {
    width: 32px;
    height: 32px;
    background: #000;
    border: 2px solid #444;
    border-radius: 50%;
    background-image: url('/media/promotion/chatbot 2.png');
    background-size: cover;
  }

  /* Input area */
  .chat-input-box {
    padding: 10px;
    display: flex;
    border-top: 1px solid #222;
    background: rgba(0,0,0,0.7);
  }

  .chat-input-box input {
    flex: 1;
    padding: 8px;
    border-radius: 6px;
    border: none;
    outline: none;
  }

  .chat-input-box button {
    margin-left: 8px;
    background: #FF4D94;
    color: white;
    border: none;
    padding: 8px 12px;
    border-radius: 6px;
    cursor: pointer;
  }
  .typing-indicator .bubble {
    background: #383838;
    color: #fff;
    font-style: italic;
    opacity: 0.8;
  }

  .typing-indicator .icon {
    width: 32px;
    height: 32px;
    background: #000;
    border: 2px solid #444;
    border-radius: 50%;
    background-image: url('/media/promotion/chatbot 2.png');
    background-size: cover;
  }

  </style>
</head>

<body>
  <div class="main-div">
    <section class="promotions-section">
      <h2 class="section-title">Promotions</h2>
      <div class="promotions-grid">

        <div class="promo-card">
          <img src="/media/promotion/1- Welcome Bonus.png" alt="Welcome Bonus" class="promo-image">
          <div class="promo-content">
            <h3 class="promo-title">ULTIMATE WELCOME BONUS</h3>
            <p class="promo-text"><strong>Triple the Fun!:</strong> Claim Up To $3000 USD On Your First Deposit!</p>
            <p class="bonus-code">BONUS CODE: <span>WELCOME50</span></p>
            <a href="promotions1/" class="read-more">READ MORE</a>
          </div>
        </div>

        <div class="promo-card">
          <img src="/media/promotion/NFL Gridiron - Thumbnail Img Size.png" alt="Welcome Bonus" class="promo-image">
          <div class="promo-content">
            <h3 class="promo-title">NFL GRIDIRON 30% <span class="dot-span">....</span> BONUS</h3>
            <p class="promo-text"><strong>Kickoff Your Week</strong> with Extra Cash! Up To $3000 USD On Your Next
              Deposit!</p>
            <p class="bonus-code">BONUS CODE: <span>NFLPLAY30</span></p>
            <a href="promotionsNFL/" class="read-more">READ MORE</a>
          </div>
        </div>

        <div class="promo-card">
          <img src="/media/promotion/Artboard 1.png" alt="Welcome Bonus" class="promo-image">
          <div class="promo-content">
            <h3 class="promo-title">SPORTS RELOAD <span class="dot-span">.......</span> BONUS</h3>
            <p class="promo-text"><strong>Letâ€™s begin the Fun!</strong> Claim Up To $3000 USD On Your Next Deposit!</p>
            <p class="bonus-code">BONUS CODE: <span>RELOAD20</span></p>
            <a href="promotionsRELOAD/" class="read-more">READ MORE</a>
          </div>
        </div>

        <div class="promo-card">
          <img src="/media/promotion/Mask group (2).png" alt="10% Bonus" class="promo-image">
          <div class="promo-content">
            <h3 class="promo-title">10% FP BONUS</h3>
            <p class="promo-text"><strong>Letâ€™s begin the Fun!</strong> Claim Up To $10000 USD on Your Next Deposit!</p>
            <p class="bonus-code">BONUS CODE: <span>WELCOME10</span></p>
            <a href="promotions2/" class="read-more">READ MORE</a>
          </div>
        </div>

        <div class="promo-card">
          <img src="/media/promotion/Mask group (3).png" alt="15% Bonus" class="promo-image">
          <div class="promo-content">
            <h3 class="promo-title">15% FP BONUS</h3>
            <p class="promo-text"><strong>Letâ€™s begin the Fun!</strong> Claim Up To $7000 USD on Your Next Deposit!</p>
            <p class="bonus-code">BONUS CODE: <span>WELCOME15</span></p>
            <a href="promotions3/" class="read-more">READ MORE</a>
          </div>
        </div>


        <!-- 2nd Row -->

        <div class="promo-card">
          <img src="/media/promotion/Mask group (4).png" alt="Welcome Bonus" class="promo-image">
          <div class="promo-content">
            <h3 class="promo-title">25% FP BONUS</h3>
            <p class="promo-text"><strong>Triple the Rewards!</strong> Claim up to $4000 USD Next Time You Deposit!</p>
            <p class="bonus-code">BONUS CODE: <span>WELCOME25</span></p>
            <a href="promotions4/" class="read-more">READ MORE</a>
          </div>
        </div>

        <div class="promo-card">
          <img src="/media/promotion/Mask group (5).png" alt="10% Bonus" class="promo-image">
          <div class="promo-content">
            <h3 class="promo-title">35% FP BONUS</h3>
            <p class="promo-text"><strong>Get More, Play More â€“</strong> Up to $3000 USD on Your Next Deposit!</p>
            <p class="bonus-code">BONUS CODE: <span>WELCOME35</span></p>
            <a href="promotions5/" class="read-more">READ MORE</a>
          </div>
        </div>

        <div class="promo-card">
          <img src="/media/promotion/Mask group (6).png" alt="15% Bonus" class="promo-image">
          <div class="promo-content">
            <h3 class="promo-title">50% FP BONUS</h3>
            <p class="promo-text"><strong>Next Deposit, Big Win â€“</strong> Unlock up to $2000 USD!</p>
            <p class="bonus-code">BONUS CODE: <span>WELCOME55</span></p>
            <a href="promotions6/" class="read-more">READ MORE</a>
          </div>
        </div>

        <!-- 3nd Row -->

        <div class="promo-card">
          <img src="/media/promotion/Mask group (7).png" alt="Welcome Bonus" class="promo-image">
          <div class="promo-content">
            <h3 class="promo-title">75% FP BONUS</h3>
            <p class="promo-text"><strong>Supercharge</strong> Your Next Deposit with up to $1500 USD!</p>
            <p class="bonus-code">BONUS CODE: <span>WELCOME75</span></p>
            <a href="promotions7/" class="read-more">READ MORE</a>
          </div>
        </div>

        <div class="promo-card">
          <img src="/media/promotion/Mask group (8).png" alt="10% Bonus" class="promo-image">
          <div class="promo-content">
            <h3 class="promo-title">100% FP BONUS</h3>
            <p class="promo-text"><strong>Triple the Action!</strong> Claim up to $1000 USD on Your Next Deposit!</p>
            <p class="bonus-code">BONUS CODE: <span>WELCOME100</span></p>
            <a href="promotions8/" class="read-more">READ MORE</a>
          </div>
        </div>

        <div class="promo-card">
          <img src="/media/promotion/Mask group (9).png" alt="15% Bonus" class="promo-image">
          <div class="promo-content">
            <h3 class="promo-title">150% FP BONUS</h3>
            <p class="promo-text"><strong>Donâ€™t Miss Out â€“</strong> Up to $700 USD Awaits on Your Next Deposit!</p>
            <p class="bonus-code">BONUS CODE: <span>WELCOME150</span></p>
            <a href="promotions9/" class="read-more">READ MORE</a>
          </div>
        </div>

        <!-- 4nd Row -->

        <div class="promo-card">
          <img src="/media/promotion/Mask group (10).png" alt="Welcome Bonus" class="promo-image">
          <div class="promo-content">
            <h3 class="promo-title">200% FP BONUS</h3>
            <p class="promo-text"><strong>Deposit Again, Win Again â€“</strong> Grab up to $500 USD!</p>
            <p class="bonus-code">BONUS CODE: <span>WELCOME200</span></p>
            <a href="promotions10/" class="read-more">READ MORE</a>
          </div>
        </div>

      </div>
    </section>
  </div>
<custom-footer></custom-footer>

<script>
class CustomFooter extends HTMLElement {
  connectedCallback() {
    this.innerHTML = `
<style>
.custom-footer {
  background-color: #11161f;
  padding: 40px 90px;
  color: #ccc;
  font-family: 'Segoe UI', Arial, sans-serif;
  font-size: 14px;
  width: 100%;
  border-top: 1px solid #00E6E6;
}

.footer-container {
  max-width: 1283px;
  margin: auto;
  display: grid;
  grid-template-columns: repeat(3, 1fr); /* Changed from 4 to 3 columns */
  column-gap: 130px; /* EXACT 130px gap between columns */
  padding: 0 45px;
  align-items: start;
}

.footer-section {
  text-align: left;
}

.footer-section h4 {
  color: #fff;
  margin-bottom: 15px;
  font-size: 16px;
  border-bottom: 2px solid #00e6e6;
  display: inline-block;
  padding-bottom: 5px;
}

.footer-section a {
  color: #00e6e6;
  display: block;
  margin-bottom: 10px;
  text-decoration: none;
  transition: color 0.3s ease;
}

.footer-section a:hover {
  color: #ff4d94;
}

.footer-section p {
  margin: 5px 0;
  line-height: 1.6;
}

.social-icons {
  margin-top: 10px;
}

.social-icons a {
  display: inline-flex;
  justify-content: center;
  align-items: center;
  margin-right: 8px;
  width: 32px;
  height: 32px;
  border: 1px solid #00e6e6;
  border-radius: 50%;
  color: #00e6e6;
  font-size: 14px;
  transition: all 0.3s ease;
}

.social-icons a:hover {
  border-color: #ff4d94;
  color: #ff4d94;
}

.footer-bottom {
  text-align: center;
  margin-top: 20px;
  padding: 15px 0;
  font-size: 12px;
  color: #888;
  border-top: 1px solid #333;
}

@media (max-width: 1024px) {
  .footer-container {
    column-gap: 50px;
  }
}

@media (max-width: 768px) {
  .footer-container {
    grid-template-columns: 1fr;
    column-gap: 0;
  }
  .footer-section {
    margin-bottom: 20px;
  }
}
</style>

<footer class="custom-footer">
  <div class="footer-container">

    <!-- Contact Us -->
    <div class="footer-section">
      <h4>Contact Us</h4>
      <p>Email: support@nolimitbet.ag</p>
      <div class="social-icons">
        <a href="https://www.facebook.com/share/1G93J4ixnD/" target="_blank" title="Facebook"><i class="fab fa-facebook-f"></i></a>
        <a href="https://x.com/No_Limit_ag?t=ED_e-sQY5BX2dBP93HU1Lw&s=08" target="_blank" title="X"><i class="fab fa-x-twitter"></i></a>
        <a href="https://www.instagram.com/nolimitbet_ag?igsh=Zmo3N3RoOHdrOTls" target="_blank" title="Instagram"><i class="fab fa-instagram"></i></a>
        <a href="https://www.tiktok.com/@nolimitbet.ag?_t=ZS-8yog8g87W23&_r=1" target="_blank" title="TikTok"><i class="fab fa-tiktok"></i></a>
      </div>
    </div>

    <!-- Quick Links -->
    <div class="footer-section">
      <h4>Quick Links</h4>
      <a href="/about-us/">About Us</a>
      <a href="/terms-conditions/">Terms & Conditions</a>
      <a href="/promotions/">Promotions</a>
    </div>

    <!-- Become an Affiliate -->
    <div class="footer-section">
      <h4>Become an Affiliate</h4>
      <p>Join our affiliate program and earn with every referral.</p>
      <p><a href="mailto:support@nolimitbet.ag" style="color:#ff4d94; font-weight:bold;">support@nolimitbet.ag</a></p>
    </div>

  </div>

  <div class="footer-bottom">
    All rights reserved Â© 2025 <strong>nolimitbet.ag</strong>
  </div>
</footer>
    `;
  }
}
customElements.define('custom-footer', CustomFooter);
</script>

<!-- Chat Widget -->
<div id="chat-widget" style="position:fixed; bottom:20px; right:20px; z-index:9999; font-family:Arial, sans-serif;">
  <!-- Floating Button -->
  <button onclick="toggleChat()" id="chat-btn"
    style="background:#00E6E6; color:white; border:none; padding:15px; border-radius:50%; font-size:22px; cursor:pointer; display:flex; align-items:center; justify-content:center;">
    <img src="/media/promotion/chatbot.png" alt="Chat" style="width:24px; height:24px;">
  </button>

  <!-- Chat Box -->
  <div id="chat-box" style="display:none;">
    <!-- Header -->
    <div class="chat-header">
      <div class="chat-header-left">
        <div class="agent-icon">
          <img src="/media/promotion/chatbot 2.png" alt="Agent">
        </div>
        <div>
          <div class="agent-name">nolimitbet.ag</div>
          <div id="agent-status" class="agent-status">Online</div>
        </div>
      </div>

      <!-- 3-dot menu -->
      <div style="position:relative;">
        <!-- give the span an id and pass the event -->
        <span id="three-dots" onclick="toggleMenu(event)" style="cursor:pointer; font-size:20px;">...</span>

        <!-- Popup menu (no inline display) -->
        <div id="chat-menu" class="chat-menu" onclick="event.stopPropagation()">
          <span id="sound-text">Enable Sound</span>
          <div class="sound-circle" onclick="toggleSound(event)">
            <span id="sound-icon">ðŸ”‡</span>
          </div>
        </div>
      </div>

    </div>

    <!-- Messages -->
    <div id="chat-messages"></div>

    <!-- Typing Indicator -->



    <!-- Input -->
    <div class="chat-input-box">
      <input type="text" id="chat-input" placeholder="Type your message...">
      <button onclick="sendMessage()">Ask âž¤</button>
    </div>
  </div>
</div>

<audio id="notificationSound" src="https://www.myinstants.com/media/sounds/notification.mp3"></audio>

  <script>
    let soundEnabled = false;
    let lastMessageCount = 0;
    window.isTyping = false; // global typing flag

    // Toggle chat box
    function toggleChat() {
      const box = document.getElementById("chat-box");
      const menu = document.getElementById("chat-menu");
      const isHidden = box.style.display === "none" || getComputedStyle(box).display === "none";

      if (isHidden) {
        box.style.display = "flex";
        menu.classList.remove('show'); // ensure menu is hidden when chat opens
      } else {
        box.style.display = "none";
        menu.classList.remove('show');
      }
    }

    // Toggle menu
    function toggleMenu(e) {
      e.stopPropagation();
      const menu = document.getElementById("chat-menu");
      menu.classList.toggle('show');
    }

    // Toggle sound
    function toggleSound(e) {
      e.stopPropagation();
      soundEnabled = !soundEnabled;
      document.getElementById("sound-icon").textContent = soundEnabled ? "ðŸ”Š" : "ðŸ”‡";
      document.getElementById("sound-text").textContent = soundEnabled ? "Disable Sound" : "Enable Sound";
    }

    // Send chat message
    function sendMessage() {
      let msg = document.getElementById("chat-input").value;
      if (!msg.trim()) return;

      fetch("/chat/send/", {
        method: "POST",
        headers: {
          "Content-Type": "application/x-www-form-urlencoded",
          "X-CSRFToken": "{{ csrf_token }}"
        },
        body: new URLSearchParams({
          "session_id": "{{ request.session.session_key|default:'guest' }}",
          "content": msg,
          "sender": "client"
        })
      })
      .then(res => res.json())
      .then(() => {
        document.getElementById("chat-input").value = "";
        loadMessages();
      });
    }

    // Load chat messages
    function loadMessages() {
      fetch("/chat/messages/{{ request.session.session_key|default:'guest' }}/")
        .then(res => res.json())
        .then(data => {
          let chat = document.getElementById("chat-messages");
          chat.innerHTML = "";

          data.forEach(m => {
            let cls = (m.sender === "client") ? "user-msg" : (m.sender === "agent") ? "agent-msg" : "bot-msg";
            let icon = (cls === "user-msg") ? "" : '<div class="icon"></div>';
            chat.innerHTML += `
              <div class="${cls}">
                ${icon}
                <div class="bubble">${m.content}</div>
              </div>`;
          });

          // Typing indicator
          if (window.isTyping) {
            chat.innerHTML += `
              <div class="agent-msg typing-indicator">
                <div class="icon"></div>
                <div class="bubble">Agent is typing...</div>
              </div>`;
          }

          chat.scrollTop = chat.scrollHeight;

          if (soundEnabled && data.length > lastMessageCount) {
            let newMsg = data[data.length - 1];
            if (newMsg.sender === "agent" || newMsg.sender === "bot") {
              document.getElementById("notificationSound").play();
            }
          }
          lastMessageCount = data.length;
        });
    }

    // Fetch agent status and update typing flag
    function fetchAgentStatus() {
      fetch("/chat/agent-status/")
        .then(res => res.json())
        .then(data => {
          // update typing and online status
          window.isTyping = data.typing;
          let statusDiv = document.getElementById("agent-status");
          if (data.online) {
            let names = data.names.join(", ");
            statusDiv.innerHTML = `<span style="width:8px; height:8px; background:green; border-radius:50%; display:inline-block;"></span> ${names} (Online)`;
          } else {
            statusDiv.innerHTML = "Product Expert";
          }
        })
        .catch(() => {
          document.getElementById("agent-status").innerHTML = "Product Expert";
          window.isTyping = false;
        });
    }

    // Auto-refresh messages and status
    setInterval(loadMessages, 3000);
    setInterval(fetchAgentStatus, 3000);

    // Initial load
    document.addEventListener("DOMContentLoaded", () => {
      loadMessages();
      fetchAgentStatus();
      document.getElementById('chat-menu').classList.remove('show');
    });

    // Close menu if click outside
    document.addEventListener('click', function(e) {
      const menu = document.getElementById("chat-menu");
      const dots = document.getElementById("three-dots");
      if (!menu.contains(e.target) && !dots.contains(e.target)) {
        menu.classList.remove('show');
      }
    });
  </script>


  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>